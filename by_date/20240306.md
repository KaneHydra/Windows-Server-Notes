---
id: "20240306"
aliases: []
tags: []
---

# 上課注意事項

## 設備

每個人有兩顆硬碟
Windows 10/11 & Windows Server 2022
每天都要領硬碟、下課要歸還

硬碟有物品編號，填寫資料時填後編號3碼

## 系統

### WindowsServer2022登入

按`Ctrl+Alt+Del`登入

密碼是`1qaz@wsx`

### WindowsServer2022 會著重在伺服器建置與架設

管理 Clinet 端
安裝軟體時，軟體部署一次推送到所有客戶端
以及要開放那些資源給用戶端

WindowsServer演進:
Windows NT
以前是用階層式解析，比較慢
Windows 2000
後來才改成用 DNS 網域名稱命名

後面有哪些版本可以再去查資料

目前使用的版本是 Windows Server 2022 Datacenter edition

所以為了模擬不同的作業系統環境
上課會使用WindowsServer系統
上面再裝虛擬機去模擬不同的環境，就不用換電腦或硬碟

### 拍照錄音錄影都要經過老師同意

只有班導&教AI的老師是內聘老師，可以隨意錄
其他老師有在業界跟補習班教課，通常是禁止拍照錄音錄影

### 問題:

1. hub vs switch vs router vs bridge vs modem vs gateway

## 初始設定

對拷的硬碟，system id 都相同，所以一開始不能上網
所以要做一些初始設定

### 產生新的 system id:

1. 按 `Win+R` 搜尋 `sysprep`
2. 啟動 sysprep.exe
3. 一般化打勾 -> 確定
   等他跑, 他會產生新的 system id
4. 之後重新登入

### 設定新的電腦名稱: 電腦名稱輸入電腦貼紙上面的主機名，全小寫，無空格，之後重新開機，設定自己的密碼

-   方法1: 設定 -> 系統 -> 關於 -> 重新命名此電腦 -> 輸入新的電腦名稱
-   方法2: 系統內容 -> 重新命名電腦(進階) -> 邊更 -> 輸入新的電腦名稱

### 設定新的 TCPIP:

-   設定 -> 網路和網際網路 -> 乙太網路 -> 右邊邊更介面卡選項
    -   找有插網絡線的那條網卡 -> 右鍵內容 -> 網際網路通訊協定第四版(TCP/IPv4)
    -   使用下列的IP位址 -> 按照機殼貼紙上面的資料輸入
    -   網路探索功能不用理他
-   之後用ping指令檢查網絡有沒有通
    -   檢查內網 ping 192.168.69.254
    -   檢查外網 ping 8.8.8.8
    -   有收到回覆表示網路有通，否則會顯示要求等候逾時

### 設定教室的NAS

檔案總管 => 左邊的本機 => 右鍵 => 連線網路磁碟機 => - 資料夾: `\\192.168.69.252\public` - `使用不同的認證連線` 打勾
帳號:`user`
密碼:`1qaz2wsx`

### Hyper-V 虛擬機

#### Hyper-V 虛擬交換器類型:

Hyper-V 虛擬交換器分3種

1. 外網:
    - host 與主機共用實體網路卡
    - host <-> 外部網路
2. 內部網路(Win10預設會建立):

-   Host <=> Client
-   Client <=> Client
-   要在 host 啟動 NAT 或路由才能對外

3. 私人網路:

-   Client <=> Client
-   無法對 host 或對外

#### 初始化

-   先找出 Hyper-V
-   右邊虛擬交換器管理員:
    -   Windows 會用對外網卡建立一個對外的虛擬交換器 virtual switch
    -   Windows 10 預設是內部虛擬交換器
    -   除了實體網卡那張switch之外，其他全部刪掉
-   把虛擬機全部刪掉，會連快照一起刪掉
-   去教室的NAS找洪旭升老師的資料夾下載: Hyper-V, 投影片,筆記
-   找 `securable測試.docx` 去做一些簡單的檢測虛擬化相容性，
    -   裝之前要是 `64, Yes, Yes`

#### 移除 Hyper-V

右上角 => 管理 => 移除角色及功能

#### 安裝 Hyper-V

右上角 => 管理 => 新增角色及功能
下一步=>
角色型或功能安裝型=>下一步=>
從伺服器集區選擇伺服器=>下一步=>
Hyper-V 打勾=>新增功能=>(要等他跑一下)下一步=>
先不用裝其他功能，下一步=>
Hyper-V，不用動=>下一步=>
把要用的網卡打勾(勾那張乙太網卡)，因為可能有多張實體網卡，要記錄一下用了哪一張=>
移轉，不用勾，下一步=>
預設存放區=>虛擬硬碟檔的位址&虛擬機器檔的位址 都改成 `D:\LAB1130306`=>下一步
之後打勾=>否=>否則會馬上重新啟動=>安裝
等他安裝=>關閉
自己重新啟動電腦

重開後會斷網，因為現在對外網路由 Hyper-V產生的虛擬交換器接管，
所以要找網路連線=>裡面的 vEthernet 外部 switch，去那裡重新設定 TCP/IP

### Hyper-V 管理員

檢查虛擬機器與硬碟的檔案要在同一個位置

#### 虛擬交換器管理員

新增虛擬交換器
剛剛Hyper-V自動新增的是外部的switch
現在要新增一個內部虛擬交換器
名稱隨意，下面記得勾內部

#### 新增虛擬機器

先安裝 WindowsServer
名稱設定為`SW`，
位置預設是剛才選的資料夾`D:\LAB1130306`，存在不同的資料夾打勾，但是不要改路徑
世代選第1代
啟動記憶體`4096`，動態記憶體打勾
網路功能網卡選剛才新增的內部網路
建立虛擬硬碟，格式選新版的`vhdx`，才能避免電源中斷時資料損毀的問題
位置他會自動產生
大小選`127`GB，反正他是動態擴充
不過固定大小的效能比較好
安裝選項，勾從可開機 CD/DVD 那個, 映像檔(iso)選`D:\軟體\`下面找WindowsServer2022那個iso檔案
下一步，完成

#### 安裝 Windows Server 2022

虛擬機器=>右鍵啟動 & 右鍵連線(才能查看畫面)
沒有金鑰
作業系統要選 Datacenter，
桌面體驗的就是有GUI界面，否則會變成只有TUI的Server core
所以我們先裝 Datacenter(桌面體驗)
打勾接受=>下一步
自定安裝=>選那顆127GB硬碟=>下一步
然後就等他安裝完成
裝好之後關機，上方工具列=>媒體=>DVD光碟機=>退出，以免他開機又進安裝畫面
之後開機，設定密碼
注意之後登入虛擬機時的 `Ctrl+Alt+Del` 要從工具列=>動作=>`Ctrl+Alt+Del`才能正確傳送指令，或是左上角那個3個正方形的小按鈕

> [!note] 密碼複雜度4原則
> . 1. 大小寫
> . 2. 數字
> . 3. 特殊符號
> . 4. 長度>=8

### tamplate虛擬機設定

1. 關閉IE增強式安全設定
    - 伺服器管理員=>本機伺服器=> IE增強式安全設定=>全部關閉
2. 設定密碼永久有效:
    - 右上角=>工具=>電腦管理=>系統工具=>本機使用者和群組=>使用者=>Administrator=>右鍵內容  
       =>密碼永久有效打勾，重新設定密碼也在右鍵的選單裡，不過看不到你是否輸入正確，所以建議先輸入在記事本，再貼過來
    - 系統管理員的密碼統一爲我常用的那組
    - 一般使用者的預設密碼統一爲 `1qaz@wsx`
    - 把"使用者登入後需要變更密碼"的選項取消勾選
    - 把"密碼永久有效"打勾
3. 關閉防火牆:
    - 控制台=>WindowsDefender防火牆=>左邊開啟或WindowsDefender防火牆=>全部勾關閉，以免做 lab 的時候 ping 被防火牆擋掉
4. `虛擬機裡面` 重新設定system id: (光碟記得先退出)
    - `Win+R` 搜尋 `sysrep` 確定 => 開啟 `sysprep` => 一般化打勾 => 關機選項選`關機`這樣他以後開機時就會自動做 system prep，之後就先不要開虛擬機
    - 我猜之後這臺虛擬機應該會作為模板，就不要去動他，要新增其他虛擬機時，會用這臺虛擬機去複製
5. 把關機後的硬碟檔案複製出來備份一下，當作父硬碟，之後就可以在建立虛擬機時使用差異式硬碟的形式，去建立新的子硬碟就好了

> [!alert] 注意事項:
> 虛擬機也要正常關機，以免出問題

#### 子硬碟

新增子硬碟
硬碟格式要選跟父硬碟相同
硬碟名稱就取`Server1.vhdx`
硬碟位置就寫`D:\LAB1130306\Server1\Virtual Hard Disks`
父硬碟就選剛才那個
做完之後會在檔案總管看到，因為我們是新增硬碟，不是虛擬機

之後就可以用已經建好的硬碟新增虛擬機，連接虛擬硬碟的步驟就可以直接使用現有的虛擬硬碟

#### 虛擬機設定 TCP/IP 固定 IP

以後才會教 DHCP 動態 IP

找 AD 架構圖 這個檔案
按照步驟操作去設定 TCP/IP
後面會教如何設架設DNS Server

#### 虛擬機改電腦名稱

就改成跟虛擬機器名稱一樣

#### 檢查host與虛擬機的IE安全性選項&防火牆是否關閉，Admin密碼是否永久有效

#### 檢查虛擬機之間網路是否設定完成

用 `ipconfig` 查看目前機器的ip
或用 `ipconfig /all`
之後虛擬機互相 ping，虛擬機 ping 主機，看是否成功

#### 虛擬機全部設定完畢後，建立檢查點CheckPoint

開機或關機的狀態都能做
以後就能直接跳到最乾淨的狀態
checkpoint 以前叫做 snapshot
在虛擬機器上面右鍵=>建立檢查點
下面檢查點的框框就會看到，以後建立其他檢查點也會顯示在這裡，會看到樹狀圖
所以一開始的檢查點，我們先點兩下重新命名，在後面加上 _初始系統_ 方便識別
以後弄壞就能跳回去之前的檢查點

### 虛擬機連外部網路

#### 方法1: 把虛擬機的網卡改接外部虛擬交換器

IPv4 TCP/IP 一樣要按照機殼上面設定，但是教室裡面ip不能衝突，所以IP位址最後一個數字+100 就不會衝突

#### 方法2: host 啟用 NAT

目前所有的虛擬機器都接到剛才建立的 _內部網卡_
所以要改實體機器的對外網卡，就是那個 virtual switch
(這裡看老師示範就好，不要亂動)
右鍵內容 =>共用=>允許共用=>這裡選剛才建立的*內部網卡*，這樣就可以上網
這裡等於把 _內部網卡_ 當作 NAT
所以每一台虛擬機的IP的網段都要改成跟*內部網卡*的網段相同，不過每臺都改很麻煩
比較快的方法是把 _內部網卡_ 的 IP位址 改成跟所有虛擬機的 default Gateway 的 IP 相同即可
不過這樣改完後，雖然可以ping外部ip，不過還沒設定dns server，無法解析外部網域名稱
所以把虛擬機網卡的其他dns server 設定為 8.8.8.8，就能正常上網
之後把共用取消，內部網卡會改回自動取得IP位址，虛擬機內部的網卡把其他dns server移除，即可復原

> [!note] DC = Domain Control Server 網域控制站
> 一般伺服器安裝完之後都是 Stand Alone Server 獨立伺服器
> 可以設定成 DC + DNS Server
> 之後會教 Web Server, IIS + FTP Server, DHCP Server
> 分散式檔案系統
> Web Farm & NLB: 多臺伺服器同時作業，以便輪流停機維護
> AD RMS 企業文件版權管理

#### 安裝 Windows Server 2022

虛擬機器=>右鍵啟動 & 右鍵連線(才能查看畫面)  
沒有金鑰  
作業系統要選 Datacenter，  
桌面體驗的就是有GUI界面，否則會變成只有TUI的Server core  
所以我們先裝 Datacenter(桌面體驗)  
打勾接受=>下一步  
自定安裝=>選那顆127GB硬碟=>下一步  
然後就等他安裝完成  
裝好之後關機，上方工具列=>媒體=>DVD光碟機=>退出，以免他開機又進安裝畫面  
之後開機，設定密碼  
注意之後登入虛擬機時的 `Ctrl+Alt+Del` 要從工具列=>動作=>`Ctrl+Alt+Del`才能正確傳送指令，或是左上角那個3個正方形的小按鈕

> [!note] 密碼複雜度4原則  
> . 1. 大小寫  
> . 2. 數字  
> . 3. 特殊符號  
> . 4. 長度>=8

### tamplate虛擬機設定

1. 關閉IE增強式安全設定
    - 伺服器管理員=>本機伺服器=> IE增強式安全設定=>全部關閉
2. 設定密碼永久有效:
    - 右上角=>工具=>電腦管理=>系統工具=>本機使用者和群組=>使用者=>Administrator=>右鍵內容  
       =>密碼永久有效打勾，重新設定密碼也在右鍵的選單裡，不過看不到你是否輸入正確，所以建議先輸入在記事本，再貼過來
    - 系統管理員的密碼統一爲我常用的那組
    - 一般使用者的預設密碼統一爲 `1qaz@wsx`
    - 把"使用者登入後需要變更密碼"的選項取消勾選
    - 把"密碼永久有效"打勾
3. 關閉防火牆:
    - 控制台=>WindowsDefender防火牆=>左邊開啟或WindowsDefender防火牆=>全部勾關閉，以免做 lab 的時候 ping 被防火牆擋掉
4. `虛擬機裡面` 重新設定system id: (光碟記得先退出)
    - `Win+R` 搜尋 `sysrep` 確定 => 開啟 `sysprep` => 一般化打勾 => 關機選項選`關機`這樣他以後開機時就會自動做 system prep，之後就先不要開虛擬機
    - 我猜之後這臺虛擬機應該會作為模板，就不要去動他，要新增其他虛擬機時，會用這臺虛擬機去複製
5. 把關機後的硬碟檔案複製出來備份一下，當作父硬碟，之後就可以在建立虛擬機時使用差異式硬碟的形式，去建立新的子硬碟就好了

> [!alert] 注意事項:  
> 虛擬機也要正常關機，以免出問題

#### 子硬碟

新增子硬碟  
硬碟格式要選跟父硬碟相同  
硬碟名稱就取`Server1.vhdx`  
硬碟位置就寫`D:\LAB1130306\Server1\Virtual Hard Disks`  
父硬碟就選剛才那個  
做完之後會在檔案總管看到，因為我們是新增硬碟，不是虛擬機

之後就可以用已經建好的硬碟新增虛擬機，連接虛擬硬碟的步驟就可以直接使用現有的虛擬硬碟

#### 虛擬機設定 TCP/IP 固定 IP

以後才會教 DHCP 動態 IP

找 AD 架構圖 這個檔案  
按照步驟操作去設定 TCP/IP  
後面會教如何設架設DNS Server

#### 虛擬機改電腦名稱

就改成跟虛擬機器名稱一樣

#### 檢查host與虛擬機的IE安全性選項&防火牆是否關閉，Admin密碼是否永久有效

#### 檢查虛擬機之間網路是否設定完成

用 `ipconfig` 查看目前機器的ip  
或用 `ipconfig /all`  
之後虛擬機互相 ping，虛擬機 ping 主機，看是否成功

#### 虛擬機全部設定完畢後，建立檢查點CheckPoint

開機或關機的狀態都能做  
以後就能直接跳到最乾淨的狀態  
checkpoint 以前叫做 snapshot  
在虛擬機器上面右鍵=>建立檢查點  
下面檢查點的框框就會看到，以後建立其他檢查點也會顯示在這裡，會看到樹狀圖  
所以一開始的檢查點，我們先點兩下重新命名，在後面加上 _初始系統_ 方便識別  
以後弄壞就能跳回去之前的檢查點

### 虛擬機連外部網路

#### 方法1: 把虛擬機的網卡改接外部虛擬交換器

IPv4 TCP/IP 一樣要按照機殼上面設定，但是教室裡面ip不能衝突，所以IP位址最後一個數字+100 就不會衝突

#### 方法2: host 啟用 NAT

目前所有的虛擬機器都接到剛才建立的 _內部網卡_  
所以要改實體機器的對外網卡，就是那個 virtual switch  
(這裡看老師示範就好，不要亂動)  
右鍵內容 =>共用=>允許共用=>這裡選剛才建立的*內部網卡*，這樣就可以上網  
這裡等於把 _內部網卡_ 當作 NAT  
所以每一台虛擬機的IP的網段都要改成跟*內部網卡*的網段相同，不過每臺都改很麻煩  
比較快的方法是把 _內部網卡_ 的 IP位址 改成跟所有虛擬機的 default Gateway 的 IP 相同即可  
不過這樣改完後，雖然可以ping外部ip，不過還沒設定dns server，無法解析外部網域名稱  
所以把虛擬機網卡的其他dns server 設定為 8.8.8.8，就能正常上網  
之後把共用取消，內部網卡會改回自動取得IP位址，虛擬機內部的網卡把其他dns server移除，即可復原

> [!note] DC = Domain Control Server 網域控制站  
> 一般伺服器安裝完之後都是 Stand Alone Server 獨立伺服器  
> 可以設定成 DC + DNS Server  
> 之後會教 Web Server, IIS + FTP Server, DHCP Server  
> 分散式檔案系統  
> Web Farm & NLB: 多臺伺服器同時作業，以便輪流停機維護  
> AD RMS 企業文件版權管理
