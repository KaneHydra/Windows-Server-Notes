---
id: 群組原則
aliases: []
tags: []
---

# 群組原則

## 群組原則管理

要升級成DC或是加入網域,才能開啟群組管理功能

原則有衝突時  
大部分以群組原則管理為優先

在設定時,原則是強制性的  
喜好設定不優先

## 群組原則類型

網域群組原則: 伺服器管理員 => 工具 => 群組原則管理 => 樹系 abc => 網域 => abc.com

站台: 伺服器管理員 => 工具 => AD 站台及服務

組織單位群組原則: AD使用者及電腦要新增組織, 才能在群組原則管理看到  
AD使用者和電腦 => abc.com => 右鍵新增 組織單位, 簡稱 OU (Orginization Unit)

上面的檢視 => 進階功能 打開  
剛才新增的OU 右鍵 內容 => 物件 => 下面防止刪除的勾取消, 才可以刪除

## 套用群組原則

### 電腦設定跟使用者設定

#### 電腦設定

-   如果還沒開機  
    電腦開機時會自動套用
-   如果已經開機
    -   DC 每隔5分鐘套用1次
    -   預設 90~120 分鐘套用1次
    -   不論是否邊更, 每隔16小時都會自動套用1次

#### 使用者設定

-   如果還沒登入
    -   使用者登入時會自動套用
-   如果已經登入
    -   預設 90~120 分鐘套用1次
    -   不論是否邊更, 每隔16小時都會自動套用1次
    -   手動套用:
        -   需要遠端登入使用者的powershell,用`gpupdate /force`強制套用

### 手動套用

```sh
# 手動套用：到網域成員電腦上
gpupdate /target:computer
gpupdate /target:user
# 兩個都套用
gpupdate /force
```

## 練習

伺服器管理員 => 工具 => AD使用者和電腦 => abc.com => 右鍵新增 組織單位, 叫做Taiwan  
然後在Taiwan OU 上右鍵新增使用者  
假設叫做s1user01,密碼1qaz@wsx,密碼永久有效

在Taiwan OU 下面新增一個子OU, 叫做 Sales  
新增使用者 s1user02,密碼一樣,密碼永久有效

伺服器管理員 => 工具 => 群組原則管理 => 樹系 abc => 網域 => abc.com  
這裡可以看到剛才新增的 Taiwan 跟 Sales

在 Taiwan 群組上面右鍵 => 新增 GPO => TGOP1  
會出現在右邊的視窗,右鍵編輯,  
這裡測試用比較不會弄壞系統的事情  
比如說 使用者設定 => 原則 => 系統管理範本 => 桌面  
右邊找 `移除桌面上的[資源回收桶]圖示`, 下面選 已啟用 (就是enable的意思)

把 win10pc1 加回 abc 網域  
開檔案總管 => 我的電腦 => 右鍵內容 => 電腦名稱右邊的 變更設定 =>  
重新命名此電腦或他的網域或工作群組右邊的變更 => 成員隸屬選 網域,輸入 abc.com  
用`abc\administrator`的帳號給予權限  
重開機後登入 `abc\s1user01` 去查看群組原則是否生效

AD使用者和電腦  
裡面的使用者  
可以右鍵直接移動到不同的群組,也可以移動到OU下面

### 繼承

#### 一般情況

子容區沒特別設定的話就會繼承父容區的設定  
子容區有設定的話,以子容區的設定為準

#### 累加性

沒有衝突的時候, 一律繼承  
有衝突的情況,優先權由大到小: 組織單位(子容區) > 網域 > 站台

#### 電腦設定和使用者設定衝突

電腦設定為準

#### 多重衝突

連結順序在前面(數字越小越前面)的為準

#### 禁止繼承

子容區可以設定拋棄繼承  
在子容區上面 => 右鍵 => 禁止繼承

#### 強制繼承

在父容區的群組原則物件 => 右鍵 => 強制  
無論子容區是否禁止繼承, 都可以強制子容區繼承

### 群組原則管理

升級DC後,預設只能用網域系統管理員登入  
不過可以改設定

伺服器管理員 => 工具 => 群組原則管理 => 樹系 abc.com => 網域 => abc.com => domain controllers => default domain controllers policy => 右鍵 => 編輯  
不是 abc.com => default domain controllers policy  
通常不會以他為準

電腦設定 => 原則 => windows 設定 => 安全性設定 => 本機原則 => 使用者權限指派  
允許本機登入

把一個指定的群組新增進來  
以後要加入新的使用者讓他可以在DC上面用本機登入

改了 群組原則管理的設定後  
本機安全性原則也會更動

不過如果有衝突時, 以群組原則優先

### 網域的帳號原則

需要網域等級的GPO設定才有效  
站台或組織等級的GPO設定的對他無效  
網域的GPO會套用到網域的帳戶，以及網域內的所有電腦的本機設定

比如說  
伺服器管理員 => 工具 => 群組原則管理 => 樹系 abc.com => 網域 => abc.com =>  
default domain controllers policy(或是自己新增一個網域等級的原則) => 右鍵 => 編輯

Dafault Domain Policy => 電腦設定 => 原則 => Windows設定 => 安全性原則 => 帳戶原則 => 密碼原則  
密碼必須符合複雜性原則

會套用到所有的網域使用者

比如說密碼長度設為0  
密碼複雜性取消  
放鬆密碼最小長度限制 取消  
這樣新增使用者時就不用密碼  
不過登入時還是會強制你輸入密碼

常用的群組原則包含  
限制某些app無法存取  
封鎖遊戲或通訊軟體  
部屬軟體等

## 用群組原則部屬軟體

-   將msi安裝檔部屬給網域使用者與電腦
    -   要把軟體封裝成msi檔
    -   使用者登入或成員啟動電腦時就會自動或很容易安裝軟體

1. 將軟體*指派*給使用者
    - 使用者登入時,會收到通告,並且有安裝檔的捷徑與教學
2. 將軟體*指派*給電腦
    - 電腦啟動時就會自動安裝(完整或部分安裝)
3. 將軟體*發佈*給使用者
    - 不會自動安裝
    - 使用者可以透過控制台安裝

好處:

-   使用弄壞時,會自動修復軟體
-   可以移除軟體

這裡使用7zip的msi安裝檔測試  
[[HyperV存取Host資料夾]]  
把7zip.msi複製到DC Server1 的`C:\msi`  
把這個資料夾開權限  
右鍵內容  
共用資料夾 everyone 可以讀取  
安全性 everyone 可以讀取

#### 安裝軟體

使用者原則 => 設定 => 軟體設定 => 軟體安裝  
右邊的視窗 => 右鍵 => 新增 => 封裝  
去指定要安裝的檔案  
開啟 => 然後使用UNC路徑 `\\server1\msi\7zip.msi`  
也可以設定是否自動升級,指派或移除

使用者重新登入後  
去控制台 => 程式和功能 => 從網路安裝  
就可以看到要安裝的程式  
可以做一個簡單的流程教學給要發佈軟體的使用者

#### 移除軟體

使用者原則 => 設定 => 軟體設定 => 軟體安裝  
右邊的視窗 => 要解除安裝的軟體 => 右鍵 => 工作 => 移除  
移除可以設定離開解除安裝,或是已經安裝的使用者可以繼續用,但是不允許新的安裝

#### 套用設定

針對使用者的設定,使用者重新登入後會生效  
針對電腦的設定,電腦重開機後會生效  
不然就是在要套用設定的電腦上面,用網域系統管理員的身份執行指令`gpupdate /force`  
並重登入或開機後即可立即套用並生效

### 電腦跟使用者的差異

開 AD 使用者和電腦  
電腦預設在 Computers 下面  
可以在指定電腦上 => 右鍵 => 移動 => 選擇指定的OU  
這樣OU針對電腦的設定才會生效

### 鎖軟體

Dafault Domain Policy => 使用者設定 => 原則 => Windows 設定 => 安全性設定 => 軟體限制原則 => 其他原則 => 新增路徑規則  
新增 `\\server1\msi`  
這樣使用者就無法從指定資料夾安裝檔案

要針對使用者的資料夾  
前面要加上 `%USERPROFILE%`
