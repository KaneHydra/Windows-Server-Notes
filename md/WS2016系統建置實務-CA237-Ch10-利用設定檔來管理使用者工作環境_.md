第 10 章 利用設定檔來管理使用者工作環境

10\-1 本機使用者設定檔

10\-2 漫遊與強制使用者設定檔

10\-3 自訂Default設定檔

10\-4 登入指令檔

10\-5 利用「主資料夾」來儲存私人檔案

# 10-1 本機使用者設定檔

* 讓使用者每次登入時都有一致的工作環境
  * 相同的桌面、網路磁碟機、滑鼠指標等
* 本機使用者設定檔
  * 使用者第一次登入時，會自動替該使用者建立此資料夾
  * 使用者的工作環境設定會被儲存在此
  * 使用者以後登入時，系統會使用此資料夾的內容來設定使用者的工作環境

# 使用者設定檔資料夾

* 位於% _SystemDrive_ %\\ __使用者__ 之內
  * 資料夾名稱 = 使用者帳戶名稱

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_0.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_1.png)

---

即使使用者之後變更帳戶名稱，此資料夾名稱也不會改變
公用資料夾內的公用文件、公用桌面資料夾(後兩者為隱藏式資料夾)也是分別對應到%SystemDrive%\ProgramData內的Documents與Desktop資料夾

# 第1次登入的起始設定

* Default __ __  __\+ __ % _SystemDrive_ %\\ProgramData
  * ProgramData儲存著所有使用者的共同設定
  * Default與ProgramData都是隱藏式資料夾
* Default \-> Default User\(舊版\)、ProgramData \-> All Users\(舊版\)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_2.png)

---

%SystemDrive%\ProgramData資料夾：例如開始功能表都會顯示系統管理工具
Default User與All Users會被顯示在%SystemDrive%\使用者資料夾內，而且只是捷徑

# 後續的登入環境設定

* 使用者所做的任何環境變更都會被儲存到使用者設定檔資料夾內
  * 不含ProgramData
* 之後使用者的登入環境
  * 使用者設定檔資料夾 \+ ProgramData
* 可透過變更變更桌面背景、滑鼠指標、網路磁碟機等來測試

---

Default資料夾的內容並不會受到影響，也就是仍然保持不變

# 查看使用者設定檔

* 可以透過【控制台系統及安全性系統進階系統設定】來查看使用者設定檔狀態
  * 預設設定檔案 ： Default

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_3.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_4.png)

# 10-2 漫遊與強制使用者設定檔

* 網域使用者到網域內任何一台電腦登入時，都擁有相同工作環境
* 漫遊使用者設定檔
  * 工作環境的變更會自動回存到漫遊使用者設定檔
* 強制使用者設定檔
  * 唯讀、工作環境的變更並不會被回存到強制使用者設定檔

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_5.png)

---

本機使用者設定檔是隨電腦而異：使用者在每一台電腦上的本機使用者設定檔都不相同，因此使用者到不同電腦登入的工作環境也不相同
漫遊與強制使用者設定檔只適合於給網域使用者來使用

# 指定漫遊使用者設定檔給使用者 - 1

在伺服器上建立共用資料夾，並賦予使用者至少 __讀取__  __/__  __寫入__ 的分享權限

使用者Alex到網域內的任何一台電腦登入時，系統會自動在共用路徑\\\\Server1\\Profiles內建立漫遊使用者設定檔資料夾Alex\.V6

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_6.png)

---

讀取/寫入分享權限：系統會根據此權限來設定其NTFS/ReFS權限，同時將完全控制的共用權限賦予Everyone
利用Domain Admins或Enterprise Admins群組成員的身分登入
此時該資料夾內尚未包含任何資料

* 使用者第一次利用此電腦登入，其工作環境是透過Default來設定
* 若使用者之前曾經利用此電腦登入過，其工作環境是透過他的本機使用者設定檔來設定
* 使用者登出時，其工作環境會被儲存到漫遊內與本機使用者設定檔內
  * 以後該使用者到網域內的任何一台電腦登入時，都會讀取漫遊使用者設定檔
* 若要擁有相同的佈景主題
  * 在其他電腦也需有相同的佈景主題
  * 選用內建的佈景主題
  * 選用位於網路伺服器的漫遊使用者設定檔資料夾內的佈景主題

---

Windows 8.1(8)、Windows 7內含佈景主題功能、但Windows Server 2012 R2必須安裝桌面體驗功能

# 測試漫遊使用者設定檔

對著Notepad按右鍵釘選到「開始」畫面

變更佈景主題

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_7.png)

# 登入時若無法存取漫遊使用者設定檔

* 若是第一次在此電腦登入的話
  * 使用Default設定檔
  * 登出時，其工作環境不會被回存到漫遊與本機使用者設定檔
* 若之前曾經在此電腦登入的話
  * 使用本機使用者設定檔
  * 登出時
    * 工作環境不會被回存到漫遊使用者設定檔內
    * 會被儲存到本機使用者設定檔內
  * 下一次登入網域時，即使已可正常存取漫遊使用者設定檔，其仍然會使用內容較新的本機使用者設定檔
    * 之後登出時，便可正常將工作環境儲存到漫遊使用者設定檔內

---

若網路伺服器的漫遊使用者設定檔與本機使用者設定檔皆因故無法存取時，則使用Default設定檔

# 系統選用漫遊或本機使用者設定檔

若本機的比較新，則讀取本機使用者設定檔

若網路伺服器上的比較新，則讀取網路伺服器上的漫遊使用者設定檔

若兩者是相同的，則直接使用本機使用者設定檔，以提高讀取效率

---

不論是使用哪一個使用者設定檔，當使用者登出時，其環境的變更都會回存到這兩個使用者設定檔內

# 變更設定檔類型

* 系統管理員可讓使用者以後登入都直接讀取本機使用者設定檔
  * 使用者所做的環境變更，只會被儲存到本機使用者設定檔
* 控制台系統及安全系統進階系統設定點擊 __使用者設定檔__ 右邊的 __設定__ 鈕

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_8.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_9.png)

---

由於使用者帳戶控制預設值的關係，若使用者不具備系統管理員權限的話，就必須輸入系統管理員帳戶與密碼後，才可以執行上述變更設定檔類型的工作

# 指定強制使用者設定檔給使用者

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_10.png)

* 利用一個臨時使用者帳戶登入
* 將工作環境設定成使用者所需、登出
* 再將此設定檔拷貝給使用者來使用
  * 拷貝到漫遊使用者設定檔資料夾
  * 利用Windows Enabler來啟用 __複製到__ 鈕
* 將 __ntuser\.dat__ 檔名改為 __ntuser\.man__
* 將強制使用者設定檔指定給使用者

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_11.png)

將ntuser\.dat改名為ntuser\.man

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_12.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_13.png)

---

顯示ntuser.dat：取消勾選隱藏已知檔案類型的副檔名與隱藏保護的作業系統檔案(建議選項)、點選顯示隱藏的檔案、資料夾及磁碟機

# 不同用戶端有不同的附檔名

* Windows 10\(1703、1607版\)、Windows Server 2016：V6
* Windows 10\(1507、1511版\)：V5
* Windows 8\.1/Windows Server 2012 R2：V4
* Windows 8/Windows Server 2012：V3
* Windows 7/Vista/Windows Server 2008\(R2\)：V2
* Windows XP：無

# 10-3 自訂Default設定檔

* 本機使用者何時會使用Default設定檔
  * 第一次在此電腦登入
  * 非第一次在此電腦登入，但卻無法讀取其本機使用者設定檔
* 網域使用者何時會使用Default設定檔
  * 未被指定使用漫遊或強制使用者設定檔，且是第一次在此電腦登入
  * 已被指定使用漫遊或強制使用者設定檔，但無法讀取漫遊、強制與本機使用者設定檔

# 網域使用者所讀取的Default設定檔

* 若網域控制站的NETLOGON內有名稱為 __Default User\.V6__ 的設定檔資料夾
  * 登入時會使用此設定檔
  * NETLOGON共用資料夾是對應到網域控制站的% _Systemroot_ %\\SYSVOL\\sysvol\\ _網域名稱_ \\scripts __ __ 資料夾
* 若網域控制站的NETLOGON內沒有名稱為 __Default User\.V6__ 的設定檔資料夾或因故無法讀取此資料夾
  * 使用本機 __%__  _SystemDrive_  __%\\__  __使用者__  __\\Default__ 設定檔

# 自訂本機的Default設定檔

* 利用臨時帳戶的本機使用者設定檔
* 自訂本機Default設定檔
  * 將臨時帳戶的本機使用者設定檔複製到本機的% _SystemDrive_ %\\使用者\\Default資料夾
  * 賦予Everyone存取權利

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_14.png)

# 自訂網域的Default設定檔

* 利用臨時帳戶的本機使用者設定檔
* 自訂網域Default設定檔
  * 將臨時帳戶的本機使用者設定檔複製到任一台網域控制站的NTELOGON\\Default User\.V6資料夾
  * 賦予Everyone存取權利

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_15.png)

# 10-4 登入指令檔

* 使用者登入時會自動執行的程式
  * 例如\.BAT或\.CMD的批次檔、\.EXE的執行檔、\.vbs的VbScript指令檔、\.js的JScript指令檔等
* 將登入指令檔複製到NETLOGON共用資料夾內
  * 網域控制站： _%_  _Systemroot_  _%_ \\SYSVOL\\ sysvol\\ _網域名稱_ \\scripts
  * 本機：自行建立NETLOGON共用資料夾

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_16.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_17.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_18.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_19.png)

---

系統管理員可以善用指令檔來執行電腦或網路的管理工作
輸入檔名即可，例如logon.vbs或SALES\logon.vbs，不可輸入完整的路徑，例如\\Server1\NETLOGON\logon.vbs
會自動將登入指令檔複製到其他網域控制站內


# 10-5 利用「主資料夾」來儲存私人檔案

我的文件：包含在漫遊使用者設定檔內，會影響登入、登出的效率

主資料夾：不包含在漫遊使用者設定檔內

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_20.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_21.png)

![](WS2016%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA237-Ch10-%E5%88%A9%E7%94%A8%E8%A8%AD%E5%AE%9A%E6%AA%94%E4%BE%86%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E8%80%85%E5%B7%A5%E4%BD%9C%E7%92%B0%E5%A2%83_22.png)

---

使用漫遊使用者設定檔的使用者在登入時可能會浪費時間在下載文件資料夾內的檔案，同時登出時也需要花費時間將檔案回存到伺服器

