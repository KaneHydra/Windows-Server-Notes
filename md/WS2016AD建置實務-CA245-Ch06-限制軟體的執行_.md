第 6 章 限制軟體的執行

6\-1 軟體限制原則概觀

6\-2 啟用軟體限制原則

# 軟體限制原則概觀

* 雖然可以利用檔案名稱來限制使用者執行指定的應用程式，然而若使用者有權變更檔案名稱的話，就可以突破此限制
* __軟體限制__  __原則__ 的安全等級分
  * 沒有限制
    * 所有登入的使用者都可以執行指定的程式\(只要使用者擁有適當的存取權限，例如NTFS權限\)
  * 不允許
    * 不論使用者對程式檔案的存取權限為何，都不允許執行
  * 基本使用者：
    * 允許以一般使用者的權限\(指派給users群組的權限\)來執行程式
    * 預設值是「沒有限制」，但是可透過以下4 種規則來建立例外設定
      * 雜湊規則、憑證規則、路徑規則、網路區域規則

# 軟體限制原則的4 種規則 - 1

* 雜湊規則
  * 系統會為被設定的程式建立雜湊值。使用者要執行此程式時，其系統會比對自行算出來的雜湊值是否與雜湊原則中的雜湊值相同，若相同，表示它就是被限制的程式，因此會被拒絕執行
  * 程式的檔案名稱被改變或被搬移到其他地點，也不會改變其雜湊值
  * 若使用者端的程式內容被變更的話\(例如感染電腦病毒\)，此時因使用者電腦所算出的雜湊值與雜湊規則中的雜湊值不相同，因此會被認為它不是受限制的程式
* 憑證規則
  * 軟體發行公司可以利用憑證來簽署其所開發的程式，而軟體限制原則可以透過此憑證來辨識程式，也就是說您可以建立 __憑證規則__ 來辨識利用此憑證所簽署的程式

* 路徑規則
  * 允許或拒絕使用者執行位於某個資料夾內的程式。若程式被搬移到其他資料夾的話，此程式將不再受到路徑規則的約束
  * 也可以透過 __登錄__ 路徑來限制，例如開放使用者可以執行在登錄中所指定之資料夾內的程式
* 網路區域規則
  * \+本機電腦

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_0.png)

* 規則的優先順序\(由高到低為\)
  * 雜湊規則、憑證規則、路徑規則、網路區域規則

# 啟用軟體限制原則

可以透過本機電腦、站台、網域與組織單位等四個不同地方來設定軟體限制原則

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_1.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_2.png)

# 建立雜湊規則

假設要限制使用者不可以安裝號稱 __網路剪刀手__ 的Netcut 3\.0版、其安裝檔案為Netcut\.exe

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_3.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_4.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_5.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_6.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_7.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_8.png)

# 建立路徑規則

* 路徑規則分為資料夾路徑與登錄路徑規則兩種
  * 可使用環境變數，例如% _Userprofile_ %、% _SystemRoot_ %、% _Appdata_ %、% _Temp_ %、% _Programfiles_ %等
* 假設要限制使用者不可以執行\\\\dc1\\SystemTools內的所有程式

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_9.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_10.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_11.png)

* 若只是要限制單一程式的話
  * 例如輸入\\\\dc1\\SystemTools\\netcut\.exe
* 若不論此程式位於何處，皆要禁止使用者執行的話，則輸入程式名稱netcut\.exe即可

# 建立登錄路徑規則

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_12.png)

其中第一個登錄路徑是要開放使用者可以執行位於C:\\Windows內的所有程式\(路徑前後要附加%符號\)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_13.png)

# 建立憑證規則 - 1

* 啟用用戶端的憑證規則
  * 透過群組原則來設定，假設是要針對組織單位 __業務部__ 內的電腦來啟用憑證規則，而且是透過 __測試用的__  __GPO__ 來設定
  * 也可以透過「強制執行憑證規則」來啟用用戶端的憑證規則
* 建立憑證規則

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_14.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_15.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_16.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_17.png)

# 建立憑證規則 - 2

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_18.png)

假設在組織單位 __業務部__ 內預設的安全等級是 __不允許__ ，但只要程式是經過Sayms公司所申請的 __程式碼簽署憑證__ 簽署的話，該程式就允許執行，假設此憑證的憑證檔為SaymsCert\.cer

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_19.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_20.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_21.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_22.png)

# 建立網路區域規則

圖中表示只要是位於 __限制的網站__ 內的程式都不允許執行

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_23.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_24.png)

# 不要將軟體限制原則套用到本機系統管理員

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_25.png)

![](WS2016AD%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA245-Ch06-%E9%99%90%E5%88%B6%E8%BB%9F%E9%AB%94%E7%9A%84%E5%9F%B7%E8%A1%8C_26.png)

