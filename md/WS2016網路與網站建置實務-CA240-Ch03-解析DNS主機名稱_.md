第 3 章 解析DNS主機名稱

3\-1 DNS概觀

3\-2 DNS伺服器的安裝與用戶端的設定

3\-3 DNS區域的建立

3\-4 DNS區域的進階設定

3\-5 動態更新

3\-6 「單一標籤名稱」解析

3\-7 求助於其他DNS伺服器

3\-8 檢測DNS伺服器

3\-9 DNS的安全防護－DNSSEC

3\-10 清除過期記錄

# DNS概觀

* 當DNS用戶端要與某台主機溝通時，它會向DNS伺服器查詢該主機的IP位址
  * DNS用戶端：resolver
  * DNS伺服器：name server\(名稱伺服器\)
* DNS伺服器會先從其DNS資料庫內來尋找，其次才會求助其它DNS伺服器

# DNS網域名稱空間

DNS樹狀結構

__根__ 內有數台DNS伺服器，分別由不同的機構在管理

最高層網域用來將組織分類，每一個最高層網域內都有數台的DNS伺服器

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_0.png)

| 網域名稱 | 說明 |
| :-: | :-: |
| biz | 適用於商業機構 |
| com | 適用於商業機構 |
| edu | 適用於教育、學術研究單位 |
| gov | 適用於官方政府單位 |
| info | 適用於所有的用途 |
| mil | 適用於國防軍事單位 |
| net | 適用於網路服務機構 |
| org | 適用於財團法人等非營利機構 |
| 國碼或區碼 | 例如tw(台灣)、cn(中國)、hk(香港)、us(美國) |

# 第2層網域

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_1.png)

* 供公司行號或組織使用，例如microsoft\.com
  * 網域名稱必須事先申請才可以在網際網路上使用

* 第2層網域之下，可再細分多層的子網域，其網域的名稱空間有連續性
* 主機的FQDN與主機名稱
  * www\.sayms\.com與www
  * pc1\.sales\.sayms\.com與pc1

# 查看主機名稱

* 利用hostname指令
* 對著 __本機__ 按右鍵內容
  * FQDN:Server1\.sayms\.com
  * DNS主機名稱:Server1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_2.png)

# DNS區域

透過它來將網域名稱空間分割為比較容易管理的小區域

區域資料被存在DNS伺服器的區域檔案或Active Directory資料庫

一台DNS伺服器內可儲存一或多個區域資料

一個區域的資料也可被儲存到多台DNS伺服器

區域檔案內的每一筆資料被稱為 __資源記錄__ \(RR\)

一個區域所涵蓋的範圍必須是網域名稱空間中連續的區域

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_3.png)

  * sayms\.com \+ mkt\.sayms\.com:可
  * sales\.sayms\.com \+ mkt\.sayms\.com:不可

# DNS伺服器

* DNS伺服器內儲存著網域名稱空間內部份區域的記錄
* 一台DNS伺服器可以儲存一個或多個區域內的記錄
  * 這些區域是此DNS伺服器的管轄範圍
  * 此DNS伺服器是這些區域的 __授權伺服器__
* 授權伺服器負責將DNS用戶端所欲查詢的記錄，提供給DNS用戶端

# DNS伺服器的種類

* 主要伺服器\(primary server\)
  * 儲存區域的正本資料
  * 可以直接在此區域內新增、刪除與修改記錄
* 次要伺服器\(secondary server\)
  * 儲存區域的副本資料
  * 區域內的記錄是從另外一台DNS伺服器透過 __區域轉送__ 複製過來，無法修改這些記錄
* 主機伺服器\(master server\)
  * __區域轉送__ 的來源伺服器
  * 可能是儲存區域正本資料的 __主要伺服器__ ，也可能是儲存副本資料的 __次要伺服器__

# 多台次要伺服器的好處

* 提供容錯能力
  * 當有DNS伺服器故障時，仍可由其他DNS伺服器繼續提供服務
* 分擔主要伺服器的負擔
  * 共同對用戶端提供服務，可以分散伺服器的負擔
* 加快查詢的速度
  * 例如可在遠地分公司安裝次要伺服器，讓分公司用戶端快速查詢到所需記錄

# 「僅快取」伺服器

* 並不負責管轄任何區域、伺服器內沒有建立任何區域
* 幫DNS用戶端向其他DNS伺服器查詢，並將查詢到的記錄儲存到快取區
  * DNS用戶端來查詢時，伺服器可以快速的從快取區讀取記錄
* 可避免 __區域轉送__ 所造成的網路負擔

# DNS的查詢模式

遞迴查詢\(recursive query\)

反覆查詢\(iterative query\)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_4.png)

# 反向查詢

* 從IP位址來查詢主機名稱
* 需在DNS伺服器內建立反向對應區域
* 區域名稱
  * 若針對網路識別碼為192\.168\.8\.0的網路來提供反向查詢服務
    * 8\.168\.192\.in\-addr\.arpa

# 動態更新

* Windows Server的DNS伺服器具備動態更新記錄的功能
  * 當DNS用戶端的主機名稱、IP位址有異動時，這些異動資料會自動傳送到DNS伺服器，以便更新DNS伺服器的資料庫

# 快取檔案cache.dns

快取檔案內儲存著 __根__ \(root\)內DNS伺服器的主機名稱與IP位址

每一台DNS伺服器內的快取檔案應該都是一樣的

Microsoft DNS伺服器的快取檔案cache\.dns位於%Systemroot%\\System32\\DNS資料夾內

# DNS伺服器的演練範例圖

DNS伺服器的IP位址設定需為靜態

先安裝好這幾台電腦的作業系統、設定電腦名稱與IP位址、將這幾台電腦的網路卡連接到同一個網路上

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_5.png)

# DNS伺服器的安裝

* 建議先設定DNS伺服器的FQDN\(dns1\.sayms\.local\)
* 將 __慣用__  __DNS__  __伺服器__ 指定到自己
  * 此電腦的其他應用程式可透過它來查詢IP位址
* 新增 __DNS__  __伺服器__ 角色
* 點擊左下角 __開始__ 圖示   Windows系統管理工具DNS
* 可【對著DNS按右鍵新增伺服器】來管理其他DNS伺服器

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_6.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_7.png)

# DNS用戶端的設定

* TCP/IP設定
* 可指定多台DNS伺服器
  * 透過圖中的 __進階__ 鈕
  * 用戶端會依照順序來與這些DNS伺服器溝通\(一直到有伺服器回應為止\)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_8.png)

# DNS查詢Q&A

* Q: DNS伺服器本身這台電腦內的應用程式所提出查詢要求      的話，會由DNS伺服器自己來提供服務嗎？
* A: 不一定！要看其 __慣用__  __DNS__  __伺服器__ 或 __其他__  __DNS__  __伺服器__ 處的IP     位址設定為何
  * 指定到自己：由DNS伺服器自己來提供服務
  * 指定到其他DNS伺服器：由該伺服器提供服務

# 使用HOSTS檔

DNS用戶端會先檢查其HOSTS檔案，其次才會向DNS伺服器查詢

位於每一台電腦的% _Systemroot_ %\\ _system32\\drivers\\_  _etc_

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_9.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_10.png)

\* Windows 10電腦預設必須以系統管理員身份來執行記事本，

才可以變更Hosts檔案內容

# DNS或NetBIOS名稱解析

* TCP/IP程式
  * 例如瀏覽器、telnet程式、ping指令等
  * DNS名稱解析方法
* 使用NetBIOS名稱
  * NetBIOS名稱解析
    * 例如【按   \+ R鍵輸入\\\\Server1】
  * 若在名稱之前加上兩個連續斜線\\\\，則其為NetBIOS電腦名稱

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_11.png)

# DNS區域的類型

* 主要區域\(primary zone\)
  * 儲存此區域的正本記錄\(master copy\)
* 次要區域\(secondary zone\)
  * 儲存此區域的副本記錄\(replica\)
* 虛設常式區域\(stub zone\)
  * 儲存著區域的副本記錄
  * 區域內只包含少數記錄\(例如SOA、NS與A記錄\)，利用它們可以找到此區域的授權伺服器

# 主要區域

* 儲存區域正本記錄
* 可以直接在此區域內新增、修改或刪除記錄
* 區域記錄可儲存在檔案或Active Directory資料庫
  * 獨立或成員伺服器：儲存在 __區域檔案__ \(預設是 _區域名稱_  __\.__  __dns__ ，位於% _Systemroot_ %\\System32\\dns\)
  * 網域控制站：可儲存在區域檔案或Active Directory資料庫\( __Active Directory__  __整合區域__ \)
  * __Active Directory__  __整合區域__ 的記錄會透過Active Directory複製機制，自動被複製到其他也是DNS伺服器的網域控制站
  * __Active Directory\(AD DS\)__  __整合區域__ 是主要區域
    * 可新增、刪除與修改此區域內的記錄

# 次要區域

儲存區域的副本記錄\(replica\)，且是儲存在 __區域檔案__ 內

利用 __區域轉送__ 從其 __主機伺服器__ 複製過來

區域內的記錄是唯讀、不可修改

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_12.png)

\* DNS伺服器A 是B與C的 __主機伺服器__

# 建立主要區域

DNS用戶端所提出的查詢要求，絕大部份為正向對應查詢

建立正向查詢主要區域

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_13.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_14.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_15.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_16.png)

# 新增主機資源記錄(A)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_17.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_18.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_19.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_20.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_21.png)

\* 先確認對方已開機且 __Windows__  __防火牆__ 未封鎖

# DNS  round-robin

* 多筆主機名稱相同、IP位址不同的記錄
  * 會將其全部提供給用戶端，但排列順序不同
* 例如www\.sayms\.local：192\.168\.8\.1與92\.168\.8\.2
  * 192\.168\.8\.1、192\.168\.8\.2
  * 192\.168\.8\.2、192\.168\.8\.1
  * 192\.168\.8\.1、192\.168\.8\.2
  * …
* 查詢者會先使用排列在清單中的第1個IP位址

# 主機記錄Q&A

Q:網域名稱為sayms\.local、網址為www\.sayms\.local、IP位    址為192\.168\.8\.99，如何讓用戶端可以利用sayms\.local來    連接網站？

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_22.png)

# 新增IPv6位址(AAAA)

對著區域按右鍵新增主機\(A或AAAA\)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_23.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_24.png)

# 新增主機的別名資源記錄(CNAME)

* 主機dns1\.sayms\.local
  * 別名www\.sayms\.local

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_25.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_26.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_27.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_28.png)

# 新增郵件交換伺服器資源記錄(MX)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_29.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_30.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_31.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_32.png)

---

1.主機或子網域
2.郵件伺服器優先順序：數字較低的優先順序較高(0最高)
3.若覺得畫面上所顯示記錄異常的話：【對著區域按右鍵重新載入】來從區域檔案或Active Directory資料庫重新載入記錄

# 建立次要區域 - 1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_33.png)

需先設定讓DNS1可以區域轉送給DSN2

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_34.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_35.png)

---

次要區域用來儲存此區域內的複本記錄，這些記錄是唯讀的
它會透過反向查詢來嘗試解析擁有此IP位址的主機名稱(FQDN)，然而目前並沒有反向對應區域可供查詢，故會顯示無法解析的警示訊息，此時可以不必理會此訊息，它並不會影響到區域轉送

# 建立次要區域 - 2

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_36.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_37.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_38.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_39.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_40.png)

---

可按F5鍵重新整理，若仍看不到記錄的話，請將DNS管理主控台關閉再重新開啟

# 次要區域的區域轉送時機

* 自動
  * 每隔15分鐘自動要求 __主機伺服器__ 執行 __區域轉送__
* 手動
  * 從主機轉送：依據SOA執行一般的區域轉送
  * 從主機轉送新的區域複本：從 __主機伺服器__ 複製完整的區域記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_41.png)

---

若覺得畫面上所顯示記錄異常的話：【對著區域按右鍵重新載入】來從區域檔案重新載入記錄

# 建立反向對應區域

* 針對192\.168\.8\.0的網路識別碼提供反向查詢服務
  * 區域名稱是8\.168\.192\.in\-addr\.arpa
  * 區域檔案名稱預設是8\.168\.192\.in\-addr\.arpa\.dns

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_42.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_43.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_44.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_45.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_46.png)

---

例如在IIS網站內透過DNS主機名稱來限制某些用戶端不可以來連線的話，則IIS網站需要利用反向查詢來檢查用戶端的主機名稱

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_47.png)

# 在反向對應區域內建立PTR記錄 - 1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_48.png)

直接在反向對應區域新增指標\(PTR\)記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_49.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_50.png)

建立主機記錄時，順便建立指標記錄

# 在反向對應區域內建立記錄 - 2

注意防火牆會封鎖ping指令的封包

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_51.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_52.png)

---

若對方Windows防火牆沒有開放或對方未開機的話的話，則此ping指令的結果畫面會出現要求等候逾時或目的地主機無法連線的訊息

# 子網域與委派網域

* DNS伺服器提供子網域查詢服務的方法\(假設管轄區域為sayms\.local、子網域為sales\.sayms\.local\)
  * 直接在sayms\.local區域之下建立子網域、直接將記錄輸入到此子網域內
  * 將子網域內的記錄委派給其他DNS伺服器來管理

---

記錄的儲存地點

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_53.png)

# 建立子網域與記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_54.png)

假設子網域為sales\.sayms\.local

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_55.png)

# 建立委派網域 - 1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_56.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_57.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_58.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_59.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_60.png)

---

由於區域mkt.sayms.local的授權伺服器本身也是位於此區域內(其FQDN為dns3.mkt.sayms.local)，因此您必須在上右圖中指明其IP位址，否則無法得知其IP位址

# 建立委派網域 - 2

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_61.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_62.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_63.png)

# 虛設常式區域

* 僅包含SOA、NS與A記錄
  * A記錄記載著授權伺服器的IP位址
  * 利用它們可得知此區域的授權伺服器
* 與委派網域的主要差別
  * 虛設常式區域內的SOA、NS與A資源記錄是從 __主機伺服器__ 透過 __區域轉送__ 複製過來
    * A \(glue A\)需隨NS一併複製
  * 委派網域內的NS記錄是由系統管理員手動建立
* DNS用戶端DNS伺服器\(虛設常式區域\)授權伺服器
  * 若無法從虛設常式區域內找到此區域的授權伺服器的話，則DNS伺服器會採用標準查詢方式

# 建立虛設常式區域 - 1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_64.png)

先設定讓DNS4可以區域轉送給DSN1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_65.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_66.png)

# 建立虛設常式區域 - 2

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_67.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_68.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_69.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_70.png)

# 建立虛設常式區域 - 3

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_71.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_72.png)

預設每隔15分鐘自動要求 __主機伺服器__ 執行 __區域__  __轉送__ 。也可手動要求執行 __區域__  __轉送__

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_73.png)

# 變更區域類型與區域檔案名稱

* 對著區域按右鍵內容
* 區域類型
  * 主要區域、次要區域或虛設常式區域
  * Active Directory\(AD DS\)整合區域

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_74.png)

# SOA記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_75.png)

* 查看快取區
  * 在DNS主控台中【點選上方 __檢視__ 功能表進階透過 __快取位址對應__ 來察看】
* 手動清除快取記錄
  * 對著 __快取位址對應__ 按右鍵清除快取

---

1.到期時間：若次要伺服器在這段時間到達時，仍然無法透過區域轉送來更新次要區域記錄的話，就不再對DNS用戶端提供此區域的查詢服務
2.最小存留時間(預設)：快取

# 單獨設定某筆記錄的TTL

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_76.png)

# 名稱伺服器的設定

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_77.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_78.png)

# 區域轉送的相關設定

* 允許區域轉送到指定伺服器
* 區域轉送的時機
  * 次要伺服器預設15分鐘要求一次區域轉送
  * 主機伺服器記錄有異動時，也可以自動通知次要伺服器

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_79.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_80.png)

# 動態更新

DNS用戶端會自動將主機名稱或IP位址的異動資料傳送到DNS伺服器

Windows Server的DNS伺服器具備動態更新功能

Windows 2000\(含\)以後的DNS用戶端都支援動態更新

---

雖然Windows NT等較舊版用戶端並不支援動態更新，但若它們是DHCP用戶端的話，仍然可以透過DHCP伺服器來動態更新

# 啟用DNS伺服器的動態更新功能

* 非安全的及安全的
* 只有安全的
  * 需 __Active Directory__  __整合區域__
  * 只有被授權的使用者可以變更區域設定或記錄，也只有網域成員電腦有權來動態更新

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_81.png)

# DNS用戶端的動態更新時機

* 用戶端的IP位址變更、新增或刪除時
* DHCP用戶端在更新租約時，例如重新開機、執行ipconfig /renew等
* 在用戶端執行ipconfig /registerdns指令
* 成員伺服器升級為網域控制站時
  * 更新與網域控制站有關的記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_82.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_83.jpg)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_84.png)

# DNS用戶端的動態更新設定

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_85.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_86.png)

# DNS動態更新Q&A

DNS1的sayms\.local為主要區域

DNS2的sayms\.local次要區域\(唯讀\)

用戶端的慣用DNS伺服器為DNS2

  * Q\.  用戶端可以向DNS2要求動態更新嗎？

  * A\.  可以，當DNS2接收到用戶端動態更新要求時，      會轉給管轄主要區域的DNS1來動態更新，完      成後再區域轉送給DNS2

# DNS用戶端的動態更新設定 - 2

* 在DNS登錄中使用這個連線的DNS尾碼
  * 電腦名稱 \+ 連線尾碼 = Win10PC1\.say123\.local
* 需先在DNS伺服器建立say123\.local區域，並啟用動態更新

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_87.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_88.png)

* 若 __這個連線的__  __DNS__  __尾碼__ 處沒有設定尾碼
  * 將DHCP伺服器選項設定中的網域名稱當作尾碼

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_89.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_90.png)

# 透過DHCP伺服器動態更新

* DNS兼DHCP用戶端可以透過DHCP伺服器來向DNS伺服器登記
* 當用戶端向DHCP伺服器租用IP位址時，DHCP伺服器會透過 __Client FQDN__ 選項\(選項81\)來告知用戶端它會代替用戶端動態更新A或PTR記錄
  * 用戶端也會透過此選項來將其FQDN傳給伺服器

# DHCP伺服器動態更新設定

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_91.png)

根據用戶端的要求來更新 A＆PTR

DHCP伺服器會將舊用戶端的DHCPREQUEST封包內的用戶端名稱與DHCP伺服器領域內的網域名稱來組成FQDN

IP位址租約到期時：DHCP 伺服器要求DNS 伺服器將A與PTR資源記錄都刪除

# DnsUpdateProxy群組 - 1

* 若AD整合區域的動態更新為 __只有安全的__ ，則最好將DHCP伺服器都加入到 __DnsUpdateProxy__ 群組內，否則:
  * DHCP伺服器將某個用戶端的A或PTR記錄傳送到DNS伺服器更新後，之後其他DHCP伺服器將無權更新此記錄
  * DHCP伺服器替未啟用動態更新功能的用戶端向DNS伺服器更新其A與PTR記錄，之後用戶端啟用了動態更新功能後將無權自行更新
* 由此群組內的成員所登記的記錄，都不具備安全性，故群組內的所有伺服器都可以更新這些記錄
* 後來才啟用動態更新功能的用戶端，不但可以動態更新其A與PTR記錄，且會成為此記錄的擁有者

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_92.png)

---

記錄的擁有者
之後若有不屬於此群組的用戶端電腦來更新此記錄時，這個用戶端就會變成此記錄的擁有者

* 若要讓DnsUpdateProxy群組所動態更新的記錄有安全性的話\(若不考慮前述後來才啟用動態更新功能的用戶端\)
  * 在AD資料庫內建立使用者帳戶、讓DnsUpdateProxy群組的DHCP伺服器都利用此帳戶來動態更新記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_93.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_94.png)

# DHCP名稱保護 - 1

* __「__ 名稱佔用\(name squatting\)」問題
  * 用戶端在DNS伺服器內所登記的名稱，被使用不同IP位址的其他用戶端電腦登記佔用了
* 解決方法：
  * Windows用戶端
    * 透過DNS記錄的權限設定，來限制只有當初登記的電腦可以來更新此記錄
  * 非Windows的DHCP用戶端
    * __DHCP__  __名稱__  __保護__  __ __ \+  __DHCID__  __資源記錄__

---

DHCID資源記錄（Dynamic Host Configuration Identifier Resource Record）

# DHCP名稱保護 - 2

* 當DHCP伺服器將IP位址出租給「非Windows」DHCP用戶端時
  * DHCP伺服器幫用戶端登記A（與PTR）記錄 \+ DHCID記錄
  * DHCID記錄載著用戶端的FQDN與該用戶端的唯一識別碼
  * 之後必須擁有此唯一識別碼的用戶端才可以透過DHCP伺服器來更新此FQDN的A記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_95.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_96.png)

---

DHCP伺服器會先透過DNS伺服器內的DHCID記錄，來檢查此A記錄是否是該用戶端所擁有，若答案是否定的話，就不允許更新此記錄

# 「單一標籤名稱」解析

* DNS主機名稱太長的話，不易記憶且容易輸入錯誤，例如
  * http://support\.asiapacifica\.sales\.sayms\.local/
* 「單一標籤名稱」
  * 可使用比較短的DNS名稱，例如http://support/
* 「單一標籤名稱」的方法
  * 自動附加尾碼
  * GlobalNames區域\(GNZ\)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_97.png)

# 自動附加尾碼

* 用戶端自動在單一標籤名稱後面附加尾碼，以便建立完整的FQDN，然後解析其IP位址
  * 主要尾碼
  * 連線特定尾碼
  * 自訂尾碼清單

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_98.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_99.png)

# 附加主要尾碼與連線特定尾碼

* http://support/ \(假設主要尾碼是sayms\.local\)
  * 主要尾碼:support\.sayms\.local
  * 連線特定尾碼:support\.say123\.local
  * DHCP伺服器選項設定的網域名稱\(say456\.local\): support\.say456\.local

# 附加主要DNS尾碼的父系尾碼

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_100.png)

* http://support/ \(假設主要尾碼是sales\.asia\.sayms\.local\)
  * support\.sales\.asia\.sayms\.local
  * support\.asia\.sayms\.local
  * support\.sayms\.local
  * \*到第2層網域名稱sayms\.local為止

# 自訂尾碼清單

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_101.png)

* http://support/
  * support\.asia\.sayms\.local
  * support\.europe\.sayms\.local
  * support\.africa\.sayms\.local
* 需在12秒內完成解析

# GlobalNames區域(GNZ)

* 若自動附加的尾碼並不是所需要的，例如主要尾碼為sayms\.local，然而要連接網站為support\.asiapacifica\.sales\.sayiis\.local
  * 將所有會用到的尾碼都新增到自訂尾碼清單內
  * 與WINS整合: 不支援IPv6
  * GlobalNames區域
    * 單一標籤
    * 正向對應區域
    * 靜態記錄

# 建立GlobalNames區域 - 1

* 最好是AD DS整合區域，以便於更容易管理與確保未來擴充性
* 透過CNAME來將單一標籤對應到一般DNS主機名稱
* 建立名稱為GlobalNames的正向區域\(假設為AD DS整合區域\)
  * 不需啟用動態更新

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_102.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_103.png)

* 在所有的授權DNS伺服器上執行以下指令
  * dnscmd \.  /Config /EnableGlobalNamesSupport 1
* 建立別名記錄\(CNAME\)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_104.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_105.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_106.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_107.png)

---

可將句點改為伺服器名稱（DNS主機名稱、NetBIOS電腦名稱或IP位址）

# DNS伺服器的解析順序

* 先GNZ、其他區域次之
* 用戶端要查詢Win10PC1test的IP位址時
  * 用戶端會自動附加尾碼，假設為Win10PC1test\.sayms\.local
* DNS伺服器收到查詢Win10PC1test\.sayms\.local的要求時
  * 先檢查GNZ內是否有Win10PC1test的別名記錄
  * 再檢查sayms\.local內是否有Win10PC1test的記錄
* 改變查詢順序
  * dnscmd \.  /Config /GlobalNamesQueryOrder \<order>
    * order:0，先查詢GNZ
    * order:1，先查詢其他區域

---

若兩種方法都失敗，但是DNS區域有與WINS整合的話，則它還會透過WINS伺服器來解析Win10PC1test名稱的IP位址

# 求助根目錄提示內的伺服器

* DNS伺服器內若沒有用戶端所需記錄的話，它會：
  * 向位於 __根目錄提示__ 內的DNS伺服器查詢 或
  * 向 __轉寄站__ 來查詢
* 求助根目錄提示內的伺服器
  * 儲存在% _Systemroot_ %\\System32\\DNS\\cache\.dns內

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_108.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_109.png)

# 轉寄站的設定

* 當DNS伺服器將用戶端的查詢要求轉給扮演轉寄站角色的另外一台DNS伺服器後\(遞迴查詢\)，就等待查詢的結果，並將得到的結果回應給DNS用戶端
* 僅轉寄伺服器\(forward\-only server\)
  * 可避免所有DNS伺服器都對直接連接外部，增加安全性

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_110.png)

# 條件轉寄站

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_111.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_112.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_113.png)

# 監視DNS設定是否正常

* 對這部DNS伺服器進行簡單查詢
  * DNS用戶端對DNS伺服器的簡單內部查詢測試
* 對其它DNS伺服器進行遞迴查詢
  * 對DNS伺服器提出遞迴查詢要求，所查詢的記錄是位於根內的一筆 NS記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_114.png)

* 在下列間隔中執行自動測試
  * 每隔一段時間就自動執行簡單或遞迴查詢測試

# 利用Nslookup指令來檢視記錄

* 執行Nslookup
  * 到 __命令提示字元__ 或Windows PowerShell環境下執行nslookup指令
  * 對著DNS伺服器按右鍵啟動nslookup
* 會反向查詢 __慣用__  __DNS__  __伺服器__ 的主機名稱
  * 若找不到的話

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_115.png)

# NSLOOKUP範例 - 1

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_116.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_117.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_118.png)

---

若此台DNS伺服器的慣用DNS伺服器被指定到127.0.0.1，而您要在這台電腦上來查詢此區域的話，請將慣用DNS伺服器改為自己的IP位址、開放區域轉送到此IP位址，或在圖中選擇到任何一台伺服器，否則查詢會被拒絕

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_119.png)

# 快取區的清除

* DNS用戶端或DNS伺服器的快取區內若有不正確記錄的話，會影響到查詢的正確性
  * 清除DNS用戶端的快取區
    * 到DNS用戶端上執行ipconfig /flushdns指令
    * 可利用ipconfig /displaydns來查看
  * 清除DNS伺服器的快取區
    * 對著DNS伺服器按右鍵清除快取

# DNS的安全防護－DNSSEC

若3號箭頭的回應封包內的IP位址遭到竄改，而且 __非授權__  __DNS__  __伺服器__ 也未執行任何檢查動作的話，則用戶端可能就會被導向到惡意網站

__非__  __授權__  __DNS__  __伺服器__ 會將此遭竄改的假資訊儲存到其快取區，造成所謂的 __DNS__  __快取中毒__ （DNS cache poisoning）現象，而且惡意者也可能會將此假資訊的TTL設定為很長的時間，造成 __快取中毒__ 現象持續數小時或數天之久

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_120.png)

* __DNS__  __快取中毒__ 現象還包含
  * 惡意者直接將假資料植入 __非授權__  __DNS__  __伺服器__ 的快取區
  * 架設一台惡意DNS伺服器，然後故意向 __非授權__  __DNS__  __伺服器__ 查詢此惡意DNS伺服器所管轄區域內的記錄，此惡意DNS伺服器卻回應與此查詢無關的假資料，但是 __非授權__  __DNS__  __伺服器__ 卻不檢查此回應

# DNSSEC基本觀念

DNSSEC（DNS Security）技術可以為DNS伺服器之間的溝通來提供安全性

例如圖中 __非__  __授權__  __DNS__  __伺服器__ 可以來確認3號箭頭的回應確實是由真的 __授權__  __DNS__  __伺服器__ 所傳送來的

__非__  __授權__  __DNS__  __伺服器__ 也會檢查此封包內的記錄是否遭到竄改

DNSSEC讓DNS用戶端所得到的IP位址等資源記錄是真實無誤的，而且可以避免快取區被植入假資料

DNSSEC透過數位簽署與加密金鑰來驗證DNS伺服器的回應是否為真實的

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_121.png)

# 非授權DNS伺服器所擁有的功能

* 針對 __授權__  __DNS__  __伺服器__ 的區域來執行 __簽署區域__ 的動作，可讓 __非授權__  __DNS__  __伺服器__ 擁有多項安全功能
  * 確保資源記錄的完整性
  * 確認資源記錄的來源是真的授權伺服器
  * 確認資源記錄不存在的真實性（authenticated denial of existence）

# 確保資源記錄的完整性與確認授權伺服器

* __非授權__  __DNS__  __伺服器__ 會檢查從 __授權__  __DNS__  __伺服器__ 傳送來的資源記錄是否遭到竄改
  * __授權__  __DNS__  __伺服器__ 內經過簽署的區域，其每一筆資源記錄各有一筆相對應的RRSIG（resource record signature）記錄
  * __非__  __授權__  __DNS__  __伺服器__ 向 __授權__  __DNS__  __伺服器__ 提出查詢記錄的要求後， __授權__  __DNS__  __伺服器__ 會將該筆記錄與其RRSIG記錄一併傳給 __非授權__  __DNS__  __伺服器__ ， __非授權__  __DNS__  __伺服器__ 會利用 __授權__  __DNS__  __伺服器__ 的公開金鑰（位於DNSKEY記錄內）與RRSIG來驗證該筆記錄是否遭到竄改
* 確認資源記錄的來源是真的授權伺服器
  * 會驗證所收到的資源記錄，是否由真的 __授權__  __伺服器__ 所傳送來的，其驗證程序同上

# 確認資源記錄不存在的真實性

* 沒有該筆資源記錄、也不會有相對應的RRSIG記錄。 __非__  __授權__  __DNS__  __伺服器__ 要如何確認記錄是真的不存在？還是假冒的DNS伺服器的欺詐行為？
* 每一筆NSEC（next secure）記錄內，除了記載所對應的一般記錄之外，還記載著下一筆一般記錄
  * __非__  __授權__  __DNS__  __伺服器__ 查詢cindypc記錄時， __授權__  __DNS__  __伺服器__ 除了會通知 __非授權__  __DNS__  __伺服器__ 無此記錄外，還會將NESC\_2記錄傳給 __非授權__  __DNS__  __伺服器__ ， __非授權__  __DNS__  __伺服器__ 根據此NSEC\_2便可知道billywin7的下一筆記錄為dennispc\(這兩筆記錄中間沒有cindypc記錄\)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_122.png)

  * NSEC會有 __zone walking__ 的安全顧慮，惡意者可以透過它來取得區域內的所有記錄，NSEC3可解決此問題。Windows Server 2012\(R2\)的DNSSEC同時支援NSEC與NSEC3

# DNSSEC實例演練 - 1

DNS6為區域saysec\.local的授權伺服器；DNS5為快取伺服器，它會透過 __轉送器__ 來將查詢要求轉送給DNS6

準備好圖中3台電腦、安裝DNS伺服器、建立領域、新增測試用記錄、設定好轉寄站

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_123.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_124.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_125.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_126.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_127.png)

dnssecok表示用戶端認識DNSSEC，利用此參數來通知DNS伺服器可以將與DNSSEC相關記錄傳過來，但因此時saysec\.local區域尚未簽署，故沒有這類的記錄可供傳送

* 簽署授權伺服器DNS6的區域saysec\.local
  * 會新增許多與DNSSEC有關的記錄，包含RRSIG、DNSKEY與NSEC3

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_128.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_129.png)

* 讓DNS5信任區域saysec\.local的公開金鑰
  * 將Trust anchor（DNSKEY、內含公開金鑰資訊）匯入到DNS5
  * 先將DNS6的C:\\Windows\\System32\\dns設定為共用資料夾

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_130.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_131.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_132.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_133.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_134.png)

---

trust anchor是被儲存在授權伺服器DNS6的上述資料夾
若授權DNS伺服器也是網域控制站的話：可將 trust anchor 分派到其他本身也是網域控制站的DNS伺服器【對著已簽署的區域按右鍵DNSSEC內容信賴起點勾選”啟用散發此區域的信賴起點”】
共有2個DNSKEY信任點，DNS5一次只使用1個，另1個為備用


* saysec\.local區域已經簽署後的測試
  * 用戶端電腦尚未要求DNS5需驗證所傳回的記錄
  * resolve\-dnsname指令會傳回與DNSSEC有關的記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_135.png)

透過原則來讓用戶端電腦強制要求DNS5需驗證從DNS6收到的記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_136.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_137.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_138.png)

---

若原則一直未生效的話，請先執行gpupdate /force指令

* saysec\.local區域已經簽署後的測試
  * 用戶端電腦會要求DNS5需驗證所傳回的記錄
  * 由DNS6傳來的記錄，會經過DNS5的驗證

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_139.png)

* 將trust anchor刪除後的測試
  * 也可直接透過DNS主控台來將saysec\.local的2個信任點刪除

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_140.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_141.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_142.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_143.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_144.png)

重新匯入saysec\.local的trust anchor後的測試

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_145.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_146.png)

# 過期記錄

  * 清除DNS伺服器內的過時記錄，以免佔用DNS資料庫的空間

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_147.png)

* 不重新整理的間隔
  * 不允許更新記錄的時間戳記\(若有變更主機名稱或IP位址的話，就允許\)
  * 可避免AD DS整合區域產生不必要的複製工作
* 重新整理的間隔
  * 允許更新記錄的時間戳記
* 在 __不重新整理的間隔__ 與 __重新整理的間隔__ 的時間都過後，用戶端仍然沒有來重新整理或更新記錄的話，該筆記錄就會被視為過期

---

過時記錄：例如已淘汰的電腦的記錄

# 清除過期記錄

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_148.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_149.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_150.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_151.png)

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_152.jpg)

# 設定過期/清除的預設值

![](WS2016%E7%B6%B2%E8%B7%AF%E8%88%87%E7%B6%B2%E7%AB%99%E5%BB%BA%E7%BD%AE%E5%AF%A6%E5%8B%99-CA240-Ch03-%E8%A7%A3%E6%9E%90DNS%E4%B8%BB%E6%A9%9F%E5%90%8D%E7%A8%B1_153.png)

